<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imagers</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 4px;
            overflow: hidden;
        }
        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        .image-box {
            position: absolute;
            transition: transform 0.3s ease, filter 0.3s ease, z-index 0.3s ease;
            border-radius: 10px;
            will-change: transform;
        }
        .image-box img {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 10px;
        }
        .image-title {
            position: absolute;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .image-box:hover .image-title {
            opacity: 1;
        }
        .image-box.focused {
            z-index: 100;
            transform: scale(1.2) !important;
            filter: blur(0) !important;
        }
        #queryTitle {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(20px);
            position: absolute;
            z-index: 999;
            padding: 10px;
            text-shadow: 0px 0px 4px white;
            border-radius: 10px;
            left: 20px;
            top: 20px;
        }
        #hoveredLanguage {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(20px);
            padding: 10px;
            border-radius: 10px;
            text-shadow: 0px 0px 4px white;
        }
    </style>
</head>
<body>
    <h1 id="queryTitle">"<span id="queryPlaceholder">Say anything</span>"</h1>
    <div id="hoveredLanguage"></div>
    <div class="container" id="imageContainer"></div>
    <audio id="dingSound" src="ding.mp3"></audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        if (annyang) {
            const container = document.getElementById('imageContainer');
            const hoveredLanguage = document.getElementById('hoveredLanguage');
            let displayedImages = [];
            let displayedTitles = [];
            let layers = [];

            const languages = [
                'en', 'sv', 'ceb', 'de', 'nl', 'fr', 'ru', 'it', 'es', 'pl',
                'war', 'vi', 'ja', 'zh', 'pt', 'uk', 'ca', 'fa', 'no', 'sh',
                'ar', 'fi', 'id', 'ro', 'cs', 'hu', 'sr', 'ko', 'ms', 'tr',
                'min', 'eo', 'kk', 'eu', 'da', 'sk', 'bg', 'he', 'lt', 'hy',
                'sl', 'hr', 'et', 'gl', 'nn', 'simple', 'uz', 'vo', 'la', 'el',
                'az', 'ur', 'hi', 'th', 'ka', 'ce', 'be', 'ta', 'mk', 'mg',
                'oc', 'lv', 'ky', 'tt', 'bs', 'tg', 'sq', 'new', 'pms', 'tl',
                'te', 'be-tarask', 'br', 'ast', 'ml', 'bn', 'io', 'af', 'pnb',
                'gu', 'nds', 'scn', 'bpy', 'pa', 'azb', 'ku', 'mn', 'su', 'si',
                'kn', 'diq', 'am', 'ckb', 'ia', 'nap', 'bug', 'bat-smg', 'wa'
            ];
            
            const langNames = {
                en: 'English', sv: 'Swedish', ceb: 'Cebuano', de: 'German', nl: 'Dutch',
                fr: 'French', ru: 'Russian', it: 'Italian', es: 'Spanish', pl: 'Polish',
                war: 'Waray', vi: 'Vietnamese', ja: 'Japanese', zh: 'Chinese', pt: 'Portuguese',
                uk: 'Ukrainian', ca: 'Catalan', fa: 'Persian', no: 'Norwegian', sh: 'Serbo-Croatian',
                ar: 'Arabic', fi: 'Finnish', id: 'Indonesian', ro: 'Romanian', cs: 'Czech',
                hu: 'Hungarian', sr: 'Serbian', ko: 'Korean', ms: 'Malay', tr: 'Turkish',
                min: 'Minangkabau', eo: 'Esperanto', kk: 'Kazakh', eu: 'Basque', da: 'Danish',
                sk: 'Slovak', bg: 'Bulgarian', he: 'Hebrew', lt: 'Lithuanian', hy: 'Armenian',
                sl: 'Slovenian', hr: 'Croatian', et: 'Estonian', gl: 'Galician', nn: 'Norwegian Nynorsk',
                simple: 'Simple English', uz: 'Uzbek', vo: 'VolapÃ¼k', la: 'Latin', el: 'Greek',
                az: 'Azerbaijani', ur: 'Urdu', hi: 'Hindi', th: 'Thai', ka: 'Georgian',
                ce: 'Chechen', be: 'Belarusian', ta: 'Tamil', mk: 'Macedonian', mg: 'Malagasy',
                oc: 'Occitan', lv: 'Latvian', ky: 'Kirghiz', tt: 'Tatar', bs: 'Bosnian',
                tg: 'Tajik', sq: 'Albanian', new: 'Newar', pms: 'Piemontese', tl: 'Tagalog',
                te: 'Telugu', 'be-tarask': 'Belarusian (Taraskievica)', br: 'Breton', ast: 'Asturian', ml: 'Malayalam',
                bn: 'Bengali', io: 'Ido', af: 'Afrikaans', pnb: 'Western Punjabi', gu: 'Gujarati',
                nds: 'Low Saxon', scn: 'Sicilian', bpy: 'Bishnupriya Manipuri', pa: 'Punjabi', azb: 'South Azerbaijani',
                ku: 'Kurdish', mn: 'Mongolian', su: 'Sundanese', si: 'Sinhalese', kn: 'Kannada',
                diq: 'Zazaki', am: 'Amharic', ckb: 'Central Kurdish', ia: 'Interlingua', nap: 'Neapolitan',
                bug: 'Buginese', 'bat-smg': 'Samogitian', wa: 'Walloon'
            };

            const showImages = function(tag) {
                tag = tag.replace(/\.$/, '');
                document.getElementById('queryPlaceholder').textContent = tag;
                container.innerHTML = '';
                displayedImages = [];
                displayedTitles = [];
                layers = [[], [], []]; // Initialize layers
                fetchImages(tag, 'en');
            };

            const fetchImages = function(tag, lang) {
                const url = `https://${lang}.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(tag)}&format=json&origin=*`;
                $.ajax({
                    url: url,
                    method: 'GET',
                    success: function(data) {
                        if (data.query.search.length > 0) {
                            data.query.search.slice(0, 10).forEach((result, index) => {
                                const title = result.title;
                                if (!displayedTitles.includes(title)) {
                                    displayedTitles.push(title);
                                    getImage(title, lang, tag, index);
                                    languages.forEach(targetLang => {
                                        if (targetLang !== 'en') {
                                            getTranslation(title, 'en', targetLang, tag, index);
                                        }
                                    });
                                }
                            });
                        }
                    },
                    error: function() {
                        console.error(`Error retrieving information for ${lang}`);
                    }
                });
            };

            const getTranslation = function(title, fromLang, toLang, tag, index) {
                const url = `https://${fromLang}.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(title)}&prop=langlinks&lllang=${toLang}&format=json&origin=*`;
                $.ajax({
                    url: url,
                    method: 'GET',
                    success: function(data) {
                        const pages = data.query.pages;
                        const pageId = Object.keys(pages)[0];
                        const translation = pages[pageId].langlinks ? pages[pageId].langlinks[0]['*'] : title;
                        if (!displayedTitles.includes(translation)) {
                            displayedTitles.push(translation);
                            getImage(translation, toLang, tag, index);
                        }
                    },
                    error: function() {
                        console.log('Error in translation fetching for ' + toLang);
                    }
                });
            };

            const getImage = function(pageTitle, lang, tag, index) {
                const url = `https://${lang}.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(pageTitle)}&prop=pageimages|info&inprop=url&pithumbsize=500&format=json&origin=*`;
                $.ajax({
                    url: url,
                    method: 'GET',
                    success: function(data) {
                        const pages = data.query.pages;
                        const pageId = Object.keys(pages)[0];
                        if (pages[pageId].thumbnail && !displayedImages.includes(pages[pageId].thumbnail.source)) {
                            displayedImages.push(pages[pageId].thumbnail.source);
                            createImageBox(pages[pageId].thumbnail.source, pageTitle, lang, index);
                        }
                    },
                    error: function() {
                        console.error(`Error retrieving images for ${lang}`);
                    }
                });
            };

            const createImageBox = function(src, title, lang, index) {
                const layerIndex = Math.floor(Math.random() * 3); // Randomly assign to one of the 3 layers
                const imgBox = document.createElement('div');
                imgBox.classList.add('image-box');
                imgBox.style.top = `${Math.random() * 80}vh`;
                imgBox.style.left = `${Math.random() * 80}vw`;
                imgBox.style.width = `${20 + Math.random() * 10}vw`;
                imgBox.style.zIndex = layerIndex;
                imgBox.style.filter = `blur(${3 - layerIndex}px)`;
                imgBox.innerHTML = `<img src="${src}" alt="${title}"><div class="image-title">${title} (${langNames[lang]})</div>`;
                layers[layerIndex].push(imgBox);
                container.appendChild(imgBox);

                imgBox.addEventListener('mouseenter', () => {
                    layers[layerIndex].forEach(box => box.classList.add('focused'));
                    hoveredLanguage.textContent = langNames[lang];
                });

                imgBox.addEventListener('mouseleave', () => {
                    layers[layerIndex].forEach(box => box.classList.remove('focused'));
                    hoveredLanguage.textContent = '';
                });

                // Add random motion
                const randomMotion = () => {
                    const x = (Math.random() - 0.5) * 20;
                    const y = (Math.random() - 0.5) * 20;
                    imgBox.style.transform = `translate(${x}px, ${y}px)`;
                };
                setInterval(randomMotion, 2000);
            };

            document.addEventListener('mousemove', (e) => {
                const x = (e.clientX / window.innerWidth) - 0.5;
                const y = (e.clientY / window.innerHeight) - 0.5;

                layers.forEach((layer, layerIndex) => {
                    layer.forEach(img => {
                        const speed = (layerIndex + 1) * 2;
                        img.style.transform = `translate(${-x * speed}px, ${-y * speed}px)`;
                    });
                });
            });

            const commands = {
                '*tag': showImages
            };

            annyang.addCommands(commands);
            annyang.start({ autoRestart: true, continuous: false });
        } else {
            document.getElementById('imageContainer').innerHTML = "<p>Your browser does not support voice recognition.</p>";
        }
    </script>
</body>
</html>
